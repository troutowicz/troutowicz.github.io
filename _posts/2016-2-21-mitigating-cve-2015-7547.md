---
layout: post
title: Mitigating CVE-2015-7547
---

This past Tuesday [CVE-2015-7547](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-7547) was released to the public. The CVE describes an 8 year old bug discovered in [glibc](https://www.gnu.org/software/libc/)'s libresolv library. Yes... __8 years old__ and affects all versions of glibc since 2.9. For a remote attacker, this vulnerability provides a way to execute DoS and RCE attacks on a target. A patch has been released and soon after updated packages were made available for affected GNU/Linux distributions. Patch your systems ASAP.

Glibc is a core library of GNU/Linux systems, meaning many services depend upon the system calls that the library provides. When updating, it is important to remember that all running services with links to glibc will need to be restarted. Not doing so will allow these services to continue making calls to the vulnerable version of the library. While manually restarting these services (possibly dozens) is one solution (possibly), it might be more practical (safe) to reboot the affected systems.

```bash
# after updating glibc this will list services with links to the old glibc
lsof +c 0 -o / | awk '$4 == "DEL" && $8 == "<glibc-lib-location>" {print $1 " " $2}'
```

There are, however, some environments where systems cannot be immediately rebooted. And perhaps manual restarts of services are undesirable. (As a side note, if either of these points are true for your environment, consider making a change.) Until either of these actions can occur, there is a way to mitigate exploitation of the vulnerability. In a high level nutshell, exploitation occurs when a host receives a crafted sequence of unexpectedly large DNS responses for a DNS request. This can occur over UDP and TCP. Carlos O'Donell, the Red Hat engineer providing [analysis](https://sourceware.org/ml/libc-alpha/2016-02/msg00416.html) of the bug, mentions that dropping UDP responses > 512 bytes and TCP responses > 1024 bytes will mitigate any possible exploits.

```bash
# iptables
iptables -I INPUT -p udp --sport 53 -m length --length 541: -j DROP
iptables -I INPUT -p tcp --sport 53 -m length --length 1065: -j DROP
```

```bash
# firewalld
firewall-cmd --direct --add-rule ipv4 filter INPUT_direct 0 -p udp --sport 53 -m length --length 541: -j DROP
firewall-cmd --direct --add-rule ipv4 filter INPUT_direct 0 -p tcp --sport 53 -m length --length 1065: -j DROP
```

While length limits will prevent attacks from this bug, there is a good possibility that the limits will break lgtm behavior. For example, think [DNSSEC](https://en.wikipedia.org/wiki/Domain_Name_System_Security_Extensions) and [zone transfers](https://en.wikipedia.org/wiki/DNS_zone_transfer). The smarter approach is dealing with the momentary downtime and rebooting the affected servers.
